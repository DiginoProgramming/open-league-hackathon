var Xe=Object.defineProperty;var ze=(i,f,l)=>f in i?Xe(i,f,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[f]=l;var P=(i,f,l)=>(ze(i,typeof f!="symbol"?f+"":f,l),l);this.tmajs=this.tmajs||{};this.tmajs.sdk=function(i){"use strict";function f(e,t){let n;const r=()=>{n!==void 0&&t&&t(n),n=void 0};return[()=>n===void 0?n=e(r):n,r]}function l(e){const t=R(),{count:n}=t;t.unsubscribe(e),n&&!t.count&&ye()}function U(e){return R().subscribe(e),()=>l(e)}class re{constructor(t,n={}){this.scope=t,this.options=n}print(t,...n){const r=new Date,o=Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(r),{textColor:s,bgColor:u}=this.options,c="font-weight: bold;padding: 0 5px;border-radius:5px";console[t](`%c${o}%c / %c${this.scope}`,`${c};background-color: lightblue;color:black`,"",`${c};${s?`color:${s};`:""}${u?`background-color:${u}`:""}`,...n)}error(...t){this.print("error",...t)}log(...t){this.print("log",...t)}}const A=new re("SDK",{bgColor:"forestgreen",textColor:"white"});let S=!1;const L=({name:e,payload:t})=>{A.log("Event received:",t?{name:e,payload:t}:{name:e})};function oe(e){S!==e&&(S=e,e?U(L):l(L))}function ie(...e){S&&A.log(...e)}class W{constructor(){P(this,"listeners",new Map);P(this,"listenersCount",0);P(this,"subscribeListeners",[])}clear(){this.listeners.clear(),this.subscribeListeners=[]}get count(){return this.listenersCount+this.subscribeListeners.length}emit(t,...n){this.subscribeListeners.forEach(o=>o({event:t,args:n})),(this.listeners.get(t)||[]).forEach(([o,s])=>{o(...n),s&&this.off(t,o)})}on(t,n,r){let o=this.listeners.get(t);return o||this.listeners.set(t,o=[]),o.push([n,r]),this.listenersCount+=1,()=>this.off(t,n)}off(t,n){const r=this.listeners.get(t)||[];for(let o=0;o<r.length;o+=1)if(n===r[o][0]){r.splice(o,1),this.listenersCount-=1;return}}subscribe(t){return this.subscribeListeners.push(t),()=>this.unsubscribe(t)}unsubscribe(t){for(let n=0;n<this.subscribeListeners.length;n+=1)if(this.subscribeListeners[n]===t){this.subscribeListeners.splice(n,1);return}}}function V(e,t,n){return window.addEventListener(e,t,n),()=>window.removeEventListener(e,t,n)}function C(...e){let t=!1;const n=[...e];return[r=>!t&&n.push(r),()=>{t||(t=!0,n.forEach(r=>r()))},t]}class E extends Error{constructor(t,n,r){super(n,{cause:r}),this.type=t,Object.setPrototypeOf(this,E.prototype)}}function d(e,t,n){return new E(e,t,n)}const $="ERR_METHOD_UNSUPPORTED",k="ERR_METHOD_PARAMETER_UNSUPPORTED",q="ERR_UNKNOWN_ENV",G="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",H="ERR_TIMED_OUT",j="ERR_UNEXPECTED_TYPE",N="ERR_PARSE",se="ERR_NAVIGATION_LIST_EMPTY",ae="ERR_NAVIGATION_CURSOR_INVALID",ce="ERR_NAVIGATION_ITEM_INVALID",ue="ERR_SSR_INIT",pe="ERR_INVALID_PATH_BASE";function w(){return d(j,"Value has unexpected type")}class v{constructor(t,n,r){this.parser=t,this.isOptional=n,this.type=r}parse(t){if(!(this.isOptional&&t===void 0))try{return this.parser(t)}catch(n){throw d(N,`Unable to parse value${this.type?` as ${this.type}`:""}`,n)}}optional(){return this.isOptional=!0,this}}function b(e,t){return()=>new v(e,!1,t)}const h=b(e=>{if(typeof e=="boolean")return e;const t=String(e);if(t==="1"||t==="true")return!0;if(t==="0"||t==="false")return!1;throw w()},"boolean");function B(e,t){const n={};for(const r in e){const o=e[r];if(!o)continue;let s,u;if(typeof o=="function"||"parse"in o)s=r,u=typeof o=="function"?o:o.parse.bind(o);else{const{type:c}=o;s=o.from||r,u=typeof c=="function"?c:c.parse.bind(c)}try{const c=u(t(s));c!==void 0&&(n[r]=c)}catch(c){throw d(N,`Unable to parse field "${r}"`,c)}}return n}function I(e){let t=e;if(typeof t=="string"&&(t=JSON.parse(t)),typeof t!="object"||t===null||Array.isArray(t))throw w();return t}function _(e,t){return new v(n=>{const r=I(n);return B(e,o=>r[o])},!1,t)}const g=b(e=>{if(typeof e=="number")return e;if(typeof e=="string"){const t=Number(e);if(!Number.isNaN(t))return t}throw w()},"number");function _e(e){return/^#[\da-f]{6}$/i.test(e)}function fe(e){return/^#[\da-f]{3}$/i.test(e)}function le(e){const t=e.replace(/\s/g,"").toLowerCase();if(_e(t))return t;if(fe(t)){let r="#";for(let o=0;o<3;o+=1)r+=t[1+o].repeat(2);return r}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce((r,o)=>{const s=parseInt(o,10).toString(16);return r+(s.length===1?"0":"")+s},"#")}const a=b(e=>{if(typeof e=="string"||typeof e=="number")return e.toString();throw w()},"string"),K=b(e=>le(a().parse(e)),"rgb");function me(e){return _({eventType:a(),eventData:t=>t}).parse(e)}function de(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(e=>{delete window[e]})}function he(e,t){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:e,eventData:t}),source:window.parent}))}function be(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(e=>{let t=window;e.forEach((n,r,o)=>{if(r===o.length-1){t[n]=he;return}n in t||(t[n]={}),t=t[n]})})}const ge={clipboard_text_received:_({req_id:a(),data:e=>e===null?e:a().optional().parse(e)}),custom_method_invoked:_({req_id:a(),result:e=>e,error:a().optional()}),invoice_closed:_({slug:a(),status:a()}),phone_requested:_({status:a()}),popup_closed:{parse(e){return _({button_id:t=>t==null?void 0:a().parse(t)}).parse(e??{})}},qr_text_received:_({data:a().optional()}),theme_changed:_({theme_params:e=>{const t=K().optional();return Object.entries(I(e)).reduce((n,[r,o])=>(n[r]=t.parse(o),n),{})}}),viewport_changed:_({height:g(),width:e=>e==null?window.innerWidth:g().parse(e),is_state_stable:h(),is_expanded:h()}),write_access_requested:_({status:a()})};function Ee(){const e=new W,t=new W;t.subscribe(r=>{e.emit("event",{name:r.event,payload:r.args[0]})}),be();const[,n]=C(de,V("resize",()=>{t.emit("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}),V("message",r=>{if(r.source!==window.parent)return;let o;try{o=me(r.data)}catch{return}const{eventType:s,eventData:u}=o,c=ge[s];try{const p=c?c.parse(u):u;t.emit(...p?[s,p]:[s])}catch(p){A.error(`An error occurred processing the "${s}" event from the Telegram application. Please, file an issue here: https://github.com/Telegram-Mini-Apps/tma.js/issues/new/choose`,o,p)}}),()=>e.clear(),()=>t.clear());return[{on:t.on.bind(t),off:t.off.bind(t),subscribe(r){return e.on("event",r)},unsubscribe(r){e.off("event",r)},get count(){return t.count+e.count}},n]}const[we,ye]=f(e=>{const[t,n]=Ee(),r=t.off.bind(t);return t.off=(o,s)=>{const{count:u}=t;r(o,s),u&&!t.count&&e()},[t,n]},([,e])=>e());function R(){return we()[0]}function Re(e,t){R().off(e,t)}function T(e,t,n){return R().on(e,t,n)}function D(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Te(e,t){const n=e.split("."),r=t.split("."),o=Math.max(n.length,r.length);for(let s=0;s<o;s+=1){const u=parseInt(n[s]||"0",10),c=parseInt(r[s]||"0",10);if(u!==c)return u>c?1:-1}return 0}function m(e,t){return Te(e,t)<=0}function O(e,t,n){if(typeof n=="string"){if(e==="web_app_open_link"&&t==="try_instant_view")return m("6.4",n);if(e==="web_app_set_header_color"&&t==="color")return m("6.9",n)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return m("6.1",t);case"web_app_open_popup":return m("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return m("6.4",t);case"web_app_switch_inline_query":return m("6.7",t);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return m("6.9",t);case"web_app_setup_settings_button":return m("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return m("7.2",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}function Pe(e){return"external"in e&&D(e.external)&&"notify"in e.external&&typeof e.external.notify=="function"}function Y(e){return"TelegramWebviewProxy"in e&&D(e.TelegramWebviewProxy)&&"postEvent"in e.TelegramWebviewProxy&&typeof e.TelegramWebviewProxy.postEvent=="function"}function J(){try{return window.self!==window.top}catch{return!0}}let F="https://web.telegram.org";function Ae(e){F=e}function X(){return F}function y(e,t,n){let r={},o;t===void 0&&n===void 0?r={}:t!==void 0&&n!==void 0?(r=n,o=t):t!==void 0&&("targetOrigin"in t?r=t:o=t);const{targetOrigin:s=X()}=r;if(ie("Posting event:",o?{event:e,data:o}:{event:e}),J()){window.parent.postMessage(JSON.stringify({eventType:e,eventData:o}),s);return}if(Pe(window)){window.external.notify(JSON.stringify({eventType:e,eventData:o}));return}if(Y(window)){window.TelegramWebviewProxy.postEvent(e,JSON.stringify(o));return}throw d(q,"Unable to determine current environment and possible way to send event. You are probably trying to use Mini Apps method outside of Telegram application environment.")}function Se(e){return(t,n)=>{if(!O(t,e))throw d($,`Method "${t}" is unsupported in Mini Apps version ${e}`);if(D(n)){let r;if(t==="web_app_open_link"&&"try_instant_view"in n?r="try_instant_view":t==="web_app_set_header_color"&&"color"in n&&(r="color"),r&&!O(t,r,e))throw d(k,`Parameter "${r}" of "${t}" method is unsupported in Mini Apps version ${e}`)}return y(t,n)}}function z(e){return({req_id:t})=>t===e}function Ne(e){return d(H,`Timeout reached: ${e}ms`)}function ve(e,t){return Promise.race([typeof e=="function"?e():e,new Promise((n,r)=>{setTimeout(()=>{r(Ne(t))},t)})])}async function M(e){let t;const n=new Promise(c=>{t=c}),{event:r,capture:o,timeout:s}=e,[,u]=C(...(Array.isArray(r)?r:[r]).map(c=>T(c,p=>(!o||o(p))&&t(p))));try{return(e.postEvent||y)(e.method,e.params),await(s?ve(n,s):n)}finally{u()}}async function Ie(e,t,n,r={}){const{result:o,error:s}=await M({...r,method:"web_app_invoke_custom_method",event:"custom_method_invoked",params:{method:e,params:t,req_id:n},capture:z(n)});if(s)throw d(G,s);return o}async function De(){if(Y(window))return!0;try{return await M({method:"web_app_request_theme",event:"theme_changed",timeout:100}),!0}catch{return!1}}function Z(e){return e instanceof E}function Oe(e,t){return Z(e)&&e.type===t}function Me(e=!0){const t=[T("reload_iframe",()=>{y("iframe_will_reload"),window.location.reload()})],n=()=>t.forEach(r=>r());if(e){const r=document.createElement("style");r.id="telegram-custom-styles",document.head.appendChild(r),t.push(T("set_custom_style",o=>{r.innerHTML=o}),()=>document.head.removeChild(r))}return y("iframe_ready",{reload_supported:!0}),n}const Ue=b(e=>e instanceof Date?e:new Date(g().parse(e)*1e3),"Date");function Q(e,t){return new v(n=>{if(typeof n!="string"&&!(n instanceof URLSearchParams))throw w();const r=typeof n=="string"?new URLSearchParams(n):n;return B(e,o=>{const s=r.get(o);return s===null?void 0:s})},!1,t)}const Le=_({id:g(),type:a(),title:a(),photoUrl:{type:a().optional(),from:"photo_url"},username:a().optional()},"Chat").optional(),x=_({addedToAttachmentMenu:{type:h().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:h().optional(),from:"allows_write_to_pm"},firstName:{type:a(),from:"first_name"},id:g(),isBot:{type:h().optional(),from:"is_bot"},isPremium:{type:h().optional(),from:"is_premium"},languageCode:{type:a().optional(),from:"language_code"},lastName:{type:a().optional(),from:"last_name"},photoUrl:{type:a().optional(),from:"photo_url"},username:a().optional()},"User").optional();function We(){return Q({authDate:{type:Ue(),from:"auth_date"},canSendAfter:{type:g().optional(),from:"can_send_after"},chat:Le,chatInstance:{type:a().optional(),from:"chat_instance"},chatType:{type:a().optional(),from:"chat_type"},hash:a(),queryId:{type:a().optional(),from:"query_id"},receiver:x,startParam:{type:a().optional(),from:"start_param"},user:x},"InitData")}function Ve(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}function Ce(e){return e.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}const $e=b(e=>{const t=K().optional();return Object.entries(I(e)).reduce((n,[r,o])=>(n[Ve(r)]=t.parse(o),n),{})},"ThemeParams");function ee(e){return Q({botInline:{type:h().optional(),from:"tgWebAppBotInline"},initData:{type:We().optional(),from:"tgWebAppData"},initDataRaw:{type:a().optional(),from:"tgWebAppData"},platform:{type:a(),from:"tgWebAppPlatform"},showSettings:{type:h().optional(),from:"tgWebAppShowSettings"},startParam:{type:a().optional(),from:"tgWebAppStartParam"},themeParams:{type:$e(),from:"tgWebAppThemeParams"},version:{type:a(),from:"tgWebAppVersion"}}).parse(e)}function te(e){return ee(e.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function ke(){return te(window.location.href)}function qe(){return performance.getEntriesByType("navigation")[0]}function Ge(){const e=qe();if(!e)throw new Error("Unable to get first navigation entry.");return te(e.name)}function ne(e){return`tma.js/${e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}`}function He(e,t){sessionStorage.setItem(ne(e),JSON.stringify(t))}function je(e){const t=sessionStorage.getItem(ne(e));try{return t?JSON.parse(t):void 0}catch{}}function Be(){return ee(je("launchParams")||"")}function Ke(e){return JSON.stringify(Object.fromEntries(Object.entries(e).map(([t,n])=>[Ce(t),n])))}function Ye(e){const{initDataRaw:t,themeParams:n,platform:r,version:o,showSettings:s,startParam:u,botInline:c}=e,p=new URLSearchParams;return p.set("tgWebAppPlatform",r),p.set("tgWebAppThemeParams",Ke(n)),p.set("tgWebAppVersion",o),t&&p.set("tgWebAppData",t),u&&p.set("tgWebAppStartParam",u),typeof s=="boolean"&&p.set("tgWebAppShowSettings",s?"1":"0"),typeof c=="boolean"&&p.set("tgWebAppBotInline",c?"1":"0"),p.toString()}function Je(e){He("launchParams",Ye(e))}function Fe(){for(const e of[ke,Ge,Be])try{const t=e();return Je(t),t}catch{}throw new Error("Unable to retrieve launch parameters from any known source.")}return i.ERR_INVALID_PATH_BASE=pe,i.ERR_INVOKE_CUSTOM_METHOD_RESPONSE=G,i.ERR_METHOD_PARAMETER_UNSUPPORTED=k,i.ERR_METHOD_UNSUPPORTED=$,i.ERR_NAVIGATION_HISTORY_EMPTY=se,i.ERR_NAVIGATION_INDEX_INVALID=ae,i.ERR_NAVIGATION_ITEM_INVALID=ce,i.ERR_PARSE=N,i.ERR_SSR_INIT=ue,i.ERR_TIMED_OUT=H,i.ERR_UNEXPECTED_TYPE=j,i.ERR_UNKNOWN_ENV=q,i.SDKError=E,i.captureSameReq=z,i.createPostEvent=Se,i.initWeb=Me,i.invokeCustomMethod=Ie,i.isIframe=J,i.isSDKError=Z,i.isSDKErrorOfType=Oe,i.isTMA=De,i.off=Re,i.on=T,i.postEvent=y,i.request=M,i.retrieveLaunchParams=Fe,i.setDebug=oe,i.setTargetOrigin=Ae,i.subscribe=U,i.supports=O,i.targetOrigin=X,i.unsubscribe=l,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),i}({});
//# sourceMappingURL=index.low-level.iife.js.map
